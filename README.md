# Design of an application that sells content

## Исходные данные

### Требования

- Необходимо спроектировать архитектуру приложения продающего контент
- Витрина: мобильное приложение
- Оплата App Store, Google Play

### Ограничения

- Количество пользователей - 100 000
- 100 TPS

### Допущения

- Инфраструктура размещена в облаке (Amazon Web Services). На самом деле это не принципиально. Решение может быть развернуто также On Premise с использованием Open Source (перечислены в приложении).
- Предполагаем, что для разработки мы можем задействовать команду разработки (Java - Spring, Javascript - React, Swift, Kotlin)
- Предполагаем, что если у нас нагрузка 100 TPS, то количество запросов на чтение каталога может быть 500 RPS (в пять раз больше)
- Предполагаем, что каталог контента не очень большой (1000 наименований товаров)
- Берем за основу средний размер контента равный 10МБ.
- Предполагаем, что после покупки контент доступен клиенту на определенный период времени. По истечению этого периода контент блокируется.

### Элементы архитектуры

- **Customer** - наш клиент, который приобретает товары
- **Mobile Application iOS** - мобильное приложение на платформе Apple iOS, доступное для скачивания в Apple Store
- **Mobile Application Android** - мобильное приложение на платформе Android, доступное для скачивания в Google Play
- **Google Play API** - API для взаимодействия с инфраструктурой Google Play. В том числе Google Pay API.
- **Apple Store API** - API для взаимодействия с инфраструктурой Apple Store. В том числе Apple Pay.
- **CDN** - сервис распределенной доставки и дистрибуции контента
- **API Gateway** - шлюз обеспечивающий взаимодействие между клиентскими приложениями и нашими сервисами (API)
- **Authentication Service** - сервис безопасной аутентификации пользователей
- **Product API Application** - программный интерфейс приложения обеспечивающего работу с каталогом контента
- **S3 Storage for static content** - объектное хранилище для статического контента
- **LDAP Service (user registry)** - реестр зарегистрированных в нашей системе пользователей
- **SQL Products Database** - БД для хранении информации о продуктах
- **SQL Orders Database** - БД для хранения информации о заказах
- **Cache** - промежуточное in-memory хранилище данных о продуктах
- **Employee** - сотрудник сервиса, который обеспечивает обработку заказов и актуализацию каталога контента
- **Orders web application** - веб-приложение для обработки заказов клиентов
- **Orders API Application** - программный интерфейс приложения обеспечивающего работу с заказами
- **Message Broker** - брокер сообщений обеспечивающий асинхронную обработку различных событий (например, отправка Push уведомлений клиентам, или квитанций об оплате)
- **S3 Storage for reports and logs** - долговременное хранилище исторических данных
- **GitLab** - здесь можно будет хранить артефакты разработки, реализовать репозиторий код, реализовать пайплайны CI/CD
- **ELK stack** - ElasticSearch для поиска информации, LogStash для сбора, обработки логов, Kibana для визуализации

### User stories

- Клиент заходит в Google Play или Apple App Store и скачивает мобильное приложение
- Клиент устанавливает приложение на устройство
- Клиент регистрируется в приложении используя SSO (учетная запись Google ID, либо Apple ID), либо вручную.
- Клиент используя функции поиска или навигацию по каталогу контента находит требуемый “товар”.
- Клиент открывает карточку товара.
- Клиент нажимает кнопку “Купить”.Откроется помощник для осуществления покупки:
- Клиент заполняет форму ввода персональных данных (ФИО, e-mail, страна, город, etc)
- Клиент заполняет форму ввода платежных реквизитов (Visa, Mastercard, Paypal, etc)
- Клиент подтверждает введенные данные и нажимает кнопку “Оплатить”
- Клиенту на на указанный им e-mail отправляется квитанция об оплате контента.
- После обработки транзакции, клиенту становится доступен приобретенный контент в разделе “Мои покупки” на определенный период времени.
- После истечения периода времени приобретенный контент становится недоступен для просмотра.
